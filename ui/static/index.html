<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeBin Client</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
        body { padding-bottom: 5rem; }
        main { padding-top: 2rem; }
        pre { white-space: pre-wrap; background: #f4f4f4; padding: 1rem; border-radius: 5px; }
    </style>
</head>
<body>

    <main class="container">
        <div id="content-container">
             </div>
    </main>

    <script>
        const API_BASE_URL = 'https://codebin-api-10we.onrender.com'; // Or your local URL
        const contentContainer = document.getElementById('content-container');

        // --- TEMPLATES ---
        // Using template literals for clean HTML generation

        const createListView = (snippets) => {
            let snippetHTML = '<p>No snippets found.</p>';
            if (snippets && snippets.length > 0) {
                snippetHTML = snippets.map(snippet => `
                    <article>
                        <hgroup>
                            <h4>${escapeHTML(snippet.title || 'Untitled')}</h4>
                            <h6>ID: <code>${snippet.id}</code></h6>
                        </hgroup>
                        <footer>
                            <small>Created on: ${new Date(snippet.created_at).toLocaleString()}</small>
                            <a href="/?view=${snippet.id}" role="button" class="outline" style="float: right;">View</a>
                        </footer>
                    </article>
                `).join('');
            }
            contentContainer.innerHTML = `
                <hgroup>
                    <h1>CodeBin</h1>
                    <h2>Latest Snippets</h2>
                </hgroup>
                ${snippetHTML}
            `;
        };

        const createDetailView = (snippet) => {
            contentContainer.innerHTML = `
                <article>
                    <header>
                        <a href="/" role="button" class="secondary">‚Üê Back to List</a>
                        <h2>${escapeHTML(snippet.title || 'Untitled')}</h2>
                    </header>
                    <pre><code>${escapeHTML(snippet.content)}</code></pre>
                    <footer>
                        <small>ID: <code>${snippet.id}</code></small><br>
                        <small>Created: ${new Date(snippet.created_at).toLocaleString()}</small>
                    </footer>
                </article>
            `;
        };
        
        // --- API & ROUTING LOGIC ---

        const router = async () => {
            contentContainer.innerHTML = '<p aria-busy="true">Loading...</p>';
            
            // MODIFIED: This is the new routing logic
            const urlParams = new URLSearchParams(window.location.search);
            const snippetIdToView = urlParams.get('view');

            try {
                if (snippetIdToView) {
                    // If a "view" param exists, fetch and display that single snippet
                    const response = await fetch(`${API_BASE_URL}/snippets/${snippetIdToView}`);
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    const snippet = await response.json();
                    createDetailView(snippet);
                } else {
                    // Otherwise, fetch and display the list of latest snippets
                    const response = await fetch(`${API_BASE_URL}/snippets`);
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    const snippets = await response.json();
                    createListView(snippets);
                }
            } catch (error) {
                console.error('Failed to load content:', error);
                contentContainer.innerHTML = '<h2>Error</h2><p>Could not load content from the server. Please try again.</p><a href="/" role="button">Go Home</a>';
            }
        };

        const escapeHTML = (str) => {
            if (!str) return "";
            const p = document.createElement("p");
            p.appendChild(document.createTextNode(str));
            return p.innerHTML;
        };

        // --- INITIALIZATION ---
        
        // Run the router when the page loads
        document.addEventListener('DOMContentLoaded', router);
    </script>
</body>
</html>